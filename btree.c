#include <stdlib.h>
#include <stdio.h>
#include "btree.h"
#include "globals.h"

struct _BoolNode {
  int val; // si left != 0, val prends la valeur de la variable concerné. Sinon val prends une valeure booléenne de feuille
  struct _BoolNode* left; // si 0
  struct _BoolNode* right; // si 1
};

struct _BoolTree {
  BoolNode* root;
};

BoolTree* btree_createTreeWith(BoolNode* root) {
  BoolTree* tree = malloc(sizeof(*tree));
  tree->root = root;
  return tree;
}

BoolNode* btree_newNode(BoolNode* l, char var, BoolNode* r) {
  BoolNode* node = malloc(sizeof(*node));
  node -> val = var;
  node -> left = l;
  node -> left = r;
  return node;
}

BoolNode* btree_newLeaf(int b) {
  BoolNode* node = malloc(sizeof(*node));
  node -> val = b;
  node -> left = 0;
  node -> left = 0;
  return node;
}

/**
 * id = 1 at first call
 */
static void rec_btree_printDot(BoolNode* node, FILE* out, int id) {
  int lid, rid;
  if(node==0) return;
  if(node->left==0) {
    // Leaf
    fprintf(out, "n%d [label=\"%d\"]\n", id, node->val);
  }
  else {
    // Node
    lid = 2*id;
    rid = 2*id+1;
    fprintf(out, "n%d [label=\"%c\"]\n", id, (char)node->val);
    fprintf(out, "n%d -- n%d\n", id, lid);
    fprintf(out, "n%d -- n%d\n", id, rid);
    rec_btree_printDot(node->left, out, lid);
    rec_btree_printDot(node->right, out, rid);
  }
}

void btree_printDot(BoolTree* btree, FILE* out) {
  fprintf(out, "## Generated by Boolean Functions v%g\n", VERSION);
  fprintf(out, "graph {\n");
  rec_btree_printDot(btree->root, out, 1);
  fprintf(out, "}\n");
}